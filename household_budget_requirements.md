# FLOWLET 要件定義書(最終版)

## 1. 概要
**アプリ名**: FLOWLET

個人用の家計簿管理アプリ。週1〜2回まとめて入力し、収支・予算・貯金目標・口座残高を一元管理する。
自宅内のローカル環境で運用し、PC・スマホからアクセス可能。

## 2. ユーザー
- **利用者**: 本人のみ
- **利用頻度**: 週1〜2回
- **記録単位**: 1回の支払い・収入ごと
- **利用環境**: 自宅Wi-Fi内(PC・スマホ)

## 3. 主要機能

### 3.1 取引管理

**取引タイプ:**
- 収入
- 支出
- 口座間移動

**記録項目:**
- 日付
- 金額
- カテゴリ(大カテゴリ・小カテゴリ)
- 口座/カード
- メモ
- (口座間移動の場合) 移動元・移動先口座、目的別貯金への割り当て

**取引の編集・削除:**
- 過去の取引を編集・削除可能
- 削除時は口座残高も自動調整

**検索・フィルター機能:**
- カテゴリでフィルタリング(大カテゴリ・小カテゴリ)
- 期間でフィルタリング(開始日〜終了日)
- メモのキーワード検索
- 複数条件の組み合わせ可能

### 3.2 カテゴリ管理

**構造:**
- 2階層(大カテゴリ→小カテゴリ)
- 収入カテゴリと支出カテゴリを分けて管理

**機能:**
- カテゴリの追加・編集・削除
- 削除時の挙動:
  - 該当カテゴリを使用した取引がある場合、「削除済みカテゴリ」に変更
  - 削除は可能だが既存取引は保持

**初期カテゴリ案:**
- 支出: 食費、住居費、光熱費、通信費、交通費、娯楽費、医療費、日用品、教育費、その他
- 収入: ※後で決定
- ※詳細な小カテゴリは後で決定

### 3.3 予算管理

**予算設定レベル:**
- 全体予算(給料日サイクル単位)
- 大カテゴリ予算
- 小カテゴリ予算

**給料日サイクル:**
- 給料日(毎月固定日、土日祝の場合は前営業日)を基準
- 1サイクル = 給料日～次の給料日前日
- 例: 給料日が25日の場合、1/25～2/24が1サイクル

**表示内容:**
- 予算額
- 使用額
- 残額
- 使用率(%)
- ※アラート機能は不要

### 3.4 口座・クレジットカード管理

**口座管理:**
- 複数口座を登録(メイン口座、貯金口座、引き落とし専用口座など)
- 初期残高設定
- 取引ごとに残高を自動計算
- 各取引でどの口座を使用したか記録

**初期設定:**
- アプリ初回起動時に各口座の初期残高を一括入力

**クレジットカード管理:**
- 複数カード登録

**カード登録項目:**
- カード名
- 引き落とし口座
- 引き落とし日(毎月○日)
- 土日祝の扱い(翌営業日 or 前営業日)※カードごとに設定
- 支払いサイクル(当月払い/翌月払い/翌々月払い)

**カード使用時の処理:**
- 支出として記録
- カード利用額に加算
- 引き落とし月を自動計算(支払いサイクルに基づく)

**表示内容:**
- 今月の利用額
- 引き落とし予定額(月別)
- 次回引き落とし日
- 引き落とし口座の現在残高
- **引き落とし口座に追加で必要な金額**

**引き落とし処理:**
- 引き落とし日に指定口座から自動減額
- 該当月のカード利用額をリセット

### 3.5 目的別貯金管理

**機能:**
- 複数の貯金目標を設定(数は未定)

**各目標の設定項目:**
- 目標名
- 目標金額
- 現在の積立額
- 達成率

**貯金の仕組み:**
- 口座間移動で貯金用口座へ移動する際、目的別に割り当て
- 例: メイン口座→貯金用口座へ10万円移動(旅行5万円、車購入5万円に割り当て)

**貯金用口座の表示:**
- 貯金用口座の総残高
- 各目標への割り当て額
- **未割り当て金額**

**貯金目標からの引き出し:**
- 方法: 貯金用口座→メイン口座へ移動
  1. 口座間移動で貯金用口座からメイン口座へ移動(目的別貯金から減額を指定)
  2. その後、メイン口座から支出として記録

### 3.6 繰り返し支出管理

**設定項目:**
- 支出名(例: 家賃、Netflix)
- 金額
- カテゴリ(大・小)
- 口座/カード
- 支払日(毎月○日)
- メモ

**自動入力ルール:**
- アプリ起動時、設定した支払日を過ぎている繰り返し支出をチェック
- 複数月分溜まっている場合、該当する全ての月分を検出

**処理フロー:**
1. アプリ起動
2. 未入力の繰り返し支出を検出
3. 「○件の繰り返し支出があります」と一覧表示
4. ユーザーが選択(全選択/個別選択可能)
5. 選択した支出を一括追加

### 3.7 口座間移動

**2つのパターン:**

**パターン1: 貯金用口座への移動**
- 移動元口座を選択
- 貯金用口座を選択
- 金額入力
- 目的別貯金への割り当て(複数可)

**パターン2: その他の口座間移動**
- 移動元口座を選択
- 移動先口座を選択(貯金用口座以外)
- 金額入力
- 目的別貯金への割り当ては不要
- 例: メイン口座→引き落とし専用口座への補充

### 3.8 統計・レポート機能

**前期間比較:**
- 比較項目:
  - 総収入
  - 総支出
  - カテゴリ別支出(大カテゴリ)
- 表示形式: 増減率(%)
- 期間: 給料日サイクル(前サイクルとの比較)

**年間サマリー:**
- 12サイクル分(給料日ベース)の集計
- サイクル別収支推移
- カテゴリ別年間支出

**カテゴリ別推移:**
- 期間選択: プリセット(3サイクル、6サイクル、12サイクル)
- 表示方法:
  - 大カテゴリの推移グラフ
  - 大カテゴリをクリック/選択すると小カテゴリの詳細が表示される

### 3.9 データ管理

- 最低12サイクル分のデータ保持
- データのエクスポート機能は不要
- データは永続的に保存(データベースに保存)
- 残高不足でも取引記録可能(制限なし)
- 自動バックアップ不要
- 復元機能不要

### 3.11 アプリ設定

**給料日設定:**
- 給料日(毎月○日)を設定
- 土日祝の場合は前営業日に自動調整
- 収入源: 本業のみ

**集計期間の計算:**
- 1サイクル = 給料日～次の給料日前日
- 例: 給料日25日の場合
  - 第1サイクル: 1/25～2/24
  - 第2サイクル: 2/25～3/24
  - 給料日が土曜の場合、前営業日(金曜)から開始

### 3.10 可視化機能

**グラフ種類:**
- サイクルごとの収支推移(折れ線グラフまたは棒グラフ)
- カテゴリ別支出(円グラフ)
  - 大カテゴリ表示
  - クリックで小カテゴリの詳細表示
- 予算達成率(プログレスバーなど)
- 貯金目標の進捗
- カテゴリ別推移(折れ線グラフ)

**表示期間:**
- 最低12サイクル分表示可能
- プリセット期間選択(3サイクル、6サイクル、12サイクル)

## 4. 画面構成

### 4.1 ダッシュボード(ホーム)
- 今サイクルの収支サマリー(収入・支出・収支)
- 残り予算(全体・主要カテゴリ)
- 口座残高一覧
- カード利用状況(今月利用額、次回引き落とし額)
- 貯金目標の進捗(上位3〜5件)
- 主要なグラフ(サイクル別推移、カテゴリ別円グラフ)

### 4.2 取引入力
- 取引タイプ選択(収入/支出/口座間移動)
- 日付入力
- 金額入力
- カテゴリ選択(大→小)
- 口座/カード選択
- メモ入力
- (口座間移動の場合) 移動元・移動先、目的別貯金割り当て

### 4.3 取引履歴
- 取引一覧(日付降順)
- フィルター機能:
  - カテゴリ(大・小)
  - 期間(開始日〜終了日)
  - メモのキーワード検索
- 各取引の編集・削除ボタン
- サイクル別集計表示

### 4.4 予算設定
- 全体予算設定
- カテゴリ別予算設定(大・小)
- 現在の使用状況表示(金額・%・残額)

### 4.5 貯金目標
- 目標一覧(進捗バー付き)
- 新規目標作成
- 目標の編集・削除
- 各目標の詳細(目標額、現在額、達成率)
- 貯金用口座の総残高
- 未割り当て金額表示

### 4.6 口座・カード管理

**口座タブ:**
- 口座一覧(残高表示)
- 新規追加・編集・削除
- 初期残高設定(初回のみ)

**カードタブ:**
- カード一覧
- 各カードの表示項目:
  - 今月利用額
  - 次回引き落とし日・金額
  - 引き落とし口座残高
  - 引き落とし口座に必要な追加金額
- 新規追加・編集・削除

### 4.7 カテゴリ管理
- タブ切り替え(収入/支出)
- カテゴリ一覧(大カテゴリ→小カテゴリの階層表示)
- 新規追加・編集・削除
- 大カテゴリと小カテゴリの紐付け管理

### 4.8 繰り返し支出設定
- 繰り返し支出一覧
- 各項目の表示:
  - 支出名
  - 金額
  - カテゴリ
  - 支払日
  - 次回支払予定日
- 新規追加・編集・削除

### 4.9 統計・レポート
- 前期間比較(収入・支出・カテゴリ別)
- 年間サマリー(12サイクル分)
- カテゴリ別推移グラフ
  - 期間選択(3サイクル、6サイクル、12サイクル)
  - 大カテゴリ選択→小カテゴリ詳細表示

### 4.10 アプリ設定
- 給料日設定(毎月○日)
- 給料日の土日祝扱い設定(前営業日固定)

## 5. 技術要件

### 5.1 プラットフォーム・環境
- **運用環境**: ローカル環境(自宅PCで起動)
- **アクセス方法**: 
  - PC: localhost または ローカルIPアドレス
  - スマホ: PCのローカルIPアドレス(同じWi-Fi内)
- **対応デバイス**: PC、スマホ
- **レスポンシブデザイン**: 両デバイスに最適化

### 5.2 対応ブラウザ
- 主要モダンブラウザ対応
  - Google Chrome(最新版)
  - Safari(最新版)
  - Firefox(最新版)
  - Microsoft Edge(最新版)

### 5.3 技術スタック

**フロントエンド:**
- TypeScript
- React

**バックエンド:**
- Spring Boot
- RESTful API

**データベース:**
- PostgreSQL(ローカル環境)

**認証:**
- JWT(JSON Web Token)
- 実装は後回し可

### 5.4 セキュリティ
- データの暗号化(パスワード等)
- ローカル環境のため外部アクセス制限は不要

### 5.5 パフォーマンス要件
- データ量: 未定(将来的な拡張を考慮した設計)
- レスポンス時間: 
  - 理想: 即座に表示
  - 許容: 数秒以内
- ページ遷移、データ取得はスムーズに動作

### 5.6 開発環境・ツール

**IDE:**
- IntelliJ IDEA(バックエンド開発)
- WebStorm(フロントエンド開発)

**バージョン管理:**
- Git
- GitHub

**コンテナ技術:**
- Docker(オプション、後から導入検討可)

**テスト:**
- 初期は不要(後から追加可)

**CI/CD:**
- 不要(手動デプロイ)

### 5.7 コスト
- **完全無料**(ローカル環境のみ使用)

## 6. 補足事項

### 6.1 給料日サイクルとカレンダー月の併用
- **集計・予算**: 給料日サイクル(給料日～次の給料日前日)
- **カード引き落とし**: カレンダー月ベース(27日など)
- 両方を適切に管理する必要がある

### 6.2 カード引き落としの詳細仕様
- 各カードで引き落とし日の土日祝扱いを設定(翌営業日 or 前営業日)
- 支払いサイクルを設定(当月払い/翌月払い/翌々月払い)
- 使用月と引き落とし月を自動計算
- 例: 1月使用、翌月払い、27日引き落とし → 2月27日に引き落とし

### 6.3 データ整合性
- 取引削除時は口座残高を自動調整
- カテゴリ削除時は既存取引を「削除済みカテゴリ」に変更
- 残高不足でも取引記録は可能(制限なし)

### 6.4 開発フェーズ
**初期開発:**
- ローカル環境で開発・運用
- 自宅Wi-Fi内でPC・スマホからアクセス
- Spring Bootの学習を兼ねる
- 実用的な家計簿として使用

**将来的な拡張(オプション):**
- クラウドへのデプロイ
- 外出先からのアクセス
- Docker化
- 自動テスト追加

## 7. 今後の検討事項
- 収入カテゴリの詳細分類
- 支出カテゴリの詳細分類(小カテゴリ)
- UI/UXの詳細デザイン
- カラースキーム
- 具体的な画面レイアウト
- ログイン機能の詳細仕様