# Phase1：MVP定義

## 前提

* 目的：収支をシンプルに記録し、家計状況を把握する
* 成功条件：1回分の入力が1分以内／現在の収支状況を即座に把握できる／1か月以上継続利用
* 利用頻度：週1回程度

---

# MVP機能分類

## Must（今すぐ必要：5機能）

### 1. 収支登録（単一フォーム）

* 日付（デフォルト当日）
* 金額
* 収入／支出区分
* メモ（任意）
* ワンクリック保存

**根拠**：記録できなければ目的を達成できない。

---

### 2. 収支一覧表示（時系列）

* 直近順表示
* 金額・日付が即視認可能

**根拠**：入力履歴を確認できなければ状況把握ができない。

---

### 3. 月次収支表示（給料日基準：今期・前期）

* 今期の収入合計
* 今期の支出合計
* 今期の収支
* 前期の収入合計
* 前期の支出合計
* 前期の収支

**仕様方針**：

* 給料日を起点とした1サイクルを「1期」と定義
* 今期：直近の給料日〜次回給料日前日
* 前期：その1つ前の給料日サイクル
* トップ画面に常時表示

**根拠**：本システムは給料日基準で生活キャッシュフローを管理する思想であるため、カレンダー月との混在は認知負荷を生む。集計基準を統一することで理解コストを下げ、週1利用でも状況を即座に把握できるようにする。

---

### 4. 期間集計（給料日基準）

* 給料日を起点とした期間収支
* 期間収入合計
* 期間支出合計
* 期間収支

**仕様方針**：

* 月初ではなく「給料日開始」を1サイクルとする
* 給料日は固定値として保持（例：毎月25日）

**根拠**：実生活のキャッシュフローは給料日基準で管理する方が実態に近く、家計把握精度が高まるため。

---

### 5. 修正機能（編集または削除）

* 金額修正
* 削除

**根拠**：入力1分以内を優先するため、事後修正を許容しないと継続利用が困難になる。

---

## Should（後で欲しい）

1. 目的別口座管理
2. 実際の口座管理（銀行口座などの残高管理）
3. クレジットカード管理（利用残高・支払管理）
4. カテゴリ機能
5. 月切替表示

**根拠**：家計構造の整理には有用だが、MVP段階では必須ではない。

---

## Could（余裕があれば）

1. CSVエクスポート
2. 簡易グラフ表示
3. メモ検索
4. タグ機能
5. スマホ最適化UI
6. ダークモード

**根拠**：利便性向上機能であり、収支把握という目的の本質ではない。

---

---

# 給料日基準ロジック詳細仕様

## 1. 前提

* 給料日は毎月固定日（例：25日）
* タイムゾーンはJST固定
* 日付単位で管理（時刻は集計に影響させない）
* 給料日が土日祝の場合は「直前の平日」に繰り上げる

※祝日は日本の祝日カレンダーを基準とする（将来的には祝日マスタを保持）

---

## 2. 給料日補正ロジック

### ■ 補正アルゴリズム

基準給料日：`base_payday`（例：毎月25日）

1. 当月の base_payday を生成
2. その日が

   * 土曜 → 前日へ
   * 日曜 → 前々日へ
   * 祝日 → 1日前へ（平日になるまで繰り返す）
3. 平日になるまで前日に繰り下げる

擬似コード：

```
actual_payday = LocalDate(year, month, base_payday)

while isWeekend(actual_payday) || isHoliday(actual_payday):
    actual_payday = actual_payday.minusDays(1)
```

※ isHoliday() は祝日マスタで判定

---

## 3. 期の定義

### ■ 今期判定ロジック

基準日：`today`
給料日：`payday`

```
if today.day >= payday:
    current_period_start = 当月payday
else:
    current_period_start = 前月payday

current_period_end = current_period_startの翌月paydayの前日
```

### ■ 前期

```
previous_period_start = current_period_startの1か月前
previous_period_end   = current_period_startの前日
```

---

## 4. 境界日の扱い

* 給料日当日は「新しい期」に含める
* 例：給料日25日の場合

  * 1/25 00:00 〜 次回2/24 23:59 を同一期

---

## 5. 月末不整合対策

例：給料日31日、2月は存在しない

仕様：

* その月の最終日を給料日とみなす

例：

* 給料日31日設定
* 2月は2/28（閏年は2/29）を給料日扱い

---

## 6. SQL集計イメージ

```
SELECT SUM(amount)
FROM transactions
WHERE transaction_date >= :period_start
  AND transaction_date <= :period_end;
```

インデックス：

* transaction_date にINDEX必須

---

## 7. 設計根拠

* 給料日補正を先に確定させることで期計算の一貫性を担保
* 「直前営業日」ルールは一般企業の給与支給慣行に一致
* 祝日考慮を明文化しないと将来的に境界バグを生むため
* 日付ベース集計に限定し、時刻依存バグを排除
* 給料日当日を開始日に含めることで二重計上を防ぐ
* 月末補正ルールを明確化し、将来のバグを回避
* 日付ベース集計に限定し、時刻依存バグを排除

---

# MVP確定スコープ

Mustは5機能に制限。

この構成により：

* 記録可能
* 今期・前期の収支比較が可能
* 給料日基準の期間収支把握可能
* 修正可能

最小構成で実用性を満たす。
